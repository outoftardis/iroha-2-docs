import{_ as s,c as a,o as n,d as e}from"./app.ced819ec.js";const F='{"title":"Rust guide","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. Iroha 2 Client Setup","slug":"_1-iroha-2-client-setup"},{"level":2,"title":"2. Configuring Iroha 2","slug":"_2-configuring-iroha-2"},{"level":2,"title":"3. Registering a Domain","slug":"_3-registering-a-domain"},{"level":2,"title":"4. Registering an Account","slug":"_4-registering-an-account"},{"level":2,"title":"5. Registering and minting assets","slug":"_5-registering-and-minting-assets"},{"level":2,"title":"6. Visualising outputs","slug":"_6-visualising-outputs"}],"relativePath":"guide/rust.md","lastUpdated":1649230251000}',o={},l=e(`<h1 id="rust-guide" tabindex="-1">Rust guide <a class="header-anchor" href="#rust-guide" aria-hidden="true">#</a></h1><h2 id="_1-iroha-2-client-setup" tabindex="-1">1. Iroha 2 Client Setup <a class="header-anchor" href="#_1-iroha-2-client-setup" aria-hidden="true">#</a></h2><p>In this part we shall cover the main things to look out for if you want to use Iroha 2. Instead of providing the complete basics, we shall assume knowledge of the most widely used concepts, explain what\u2019s unusual about Iroha 2 specifically, and provide a step-by-step guide to creating your own Rust client for it.</p><p>We assume that you know how to create a new package and have basic understanding of the fundamental Rust code; <code>async</code> functions, <code>enum</code> types, traits and borrowing/ownership, as well as usage of the libraries that we also use: <code>serde</code>, <code>tokio</code>, <code>tracing</code> etc. If you don&#39;t feel comfortable with any of the above, we recommend consulting <a href="https://doc.rust-lang.org/stable/book/" target="_blank" rel="noopener noreferrer">the Rust book</a> and <a href="https://docs.rs/" target="_blank" rel="noopener noreferrer">docs.rs</a>.</p><p>Iroha 2 makes extensive use of <a href="https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html" target="_blank" rel="noopener noreferrer">workspaces</a> (or crates), that go in a domain-first order. What that means is that instead of having a global <em>constants</em> crate, we have a crate for the blockchain data model (<code>iroha_data_model</code>), a crate with cryptographic primitives <code>iroha_crypto</code> and so on. These, <em>individually</em> have a module for constants.</p><p>If you add <code>iroha_client</code> to the other two crates, you get the minimum number of dependencies to start your own client, similar to <code>iroha_client_cli</code>. We expect to create a package on <a href="https://crates.io/" target="_blank" rel="noopener noreferrer">crates.io</a>, with all the documentation once the initial <code>v2.0.0</code> release is complete. In the meantime, you could use the local copy that you&#39;ve just created in the <a href="/iroha-2-docs/guide/build-and-install.html">previous step</a> as a local installation in your client\u2019s <code>Cargo.toml</code>.</p><div class="language-toml"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">[</span><span style="color:#953800;">dependencies</span><span style="color:#24292F;">]</span></span>
<span class="line"><span style="color:#24292F;">iroha_client = { version = </span><span style="color:#0A3069;">&quot;=2.0.0-pre.1&quot;</span><span style="color:#24292F;">, path = </span><span style="color:#0A3069;">&quot;~/Git/iroha/client&quot;</span><span style="color:#24292F;"> }</span></span>
<span class="line"><span style="color:#24292F;">iroha_data_model = { version = </span><span style="color:#0A3069;">&quot;=2.0.0-pre.1&quot;</span><span style="color:#24292F;">, path = </span><span style="color:#0A3069;">&quot;~/Git/iroha/data_model&quot;</span><span style="color:#24292F;"> }</span></span>
<span class="line"><span style="color:#24292F;">iroha_crypto = { version = </span><span style="color:#0A3069;">&quot;=2.0.0-pre.1&quot;</span><span style="color:#24292F;">, path = </span><span style="color:#0A3069;">&quot;~/Git/iroha/crypto&quot;</span><span style="color:#24292F;"> }</span></span>
<span class="line"></span></code></pre></div><p>The added benefit of using a local copy, is that you have access to the minimal BFT network in the form of <code>docker-compose.yml</code>.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>You could also make use of our <code>test_network</code> crate, which is available via GitHub, but not <a href="https://crates.io/" target="_blank" rel="noopener noreferrer">crates.io</a>.</p></div><p>You would also benefit from having immediate access to the example configurations in the <code>~/Git/iroha/configs</code> folder.</p><p>So let\u2019s copy the example client configuration somewhere useful.</p><div class="language-bash"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">cp -vfr </span><span style="color:#CF222E;">~</span><span style="color:#24292F;">/Git/iroha/configs/client_cli/config.json example/config.json</span></span>
<span class="line"></span></code></pre></div><p>You should look through it, to familiarise with the key pieces of information that every Iroha 2 client needs. Specifically, each client operates on behalf of a pre-existing account. These accounts are identified by a <em>name@domain_name</em> ID and can only be accessed provided that you know their specific key.</p><h2 id="_2-configuring-iroha-2" tabindex="-1">2. Configuring Iroha 2 <a class="header-anchor" href="#_2-configuring-iroha-2" aria-hidden="true">#</a></h2><p>Your application written in Rust needs to instantiate a client. The client, typically needs specific configuration options, which you could either generate, or load from a the provided <code>config.json</code>. Let&#39;s do that now:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_clientconfig</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Configuration</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">as</span><span style="color:#24292F;"> </span><span style="color:#953800;">ClientConfiguration</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> cfg </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">serde_json</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">from_reader</span><span style="color:#24292F;">(file)</span><span style="color:#CF222E;">?</span><span style="color:#24292F;">;</span></span>
<span class="line"></span></code></pre></div><p>Using that configuration, it should be straightforward to instantiate a basic client.</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_client</span><span style="color:#CF222E;">::</span><span style="color:#953800;">client</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Client</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">mut</span><span style="color:#24292F;"> iroha_client </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">Client</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(cfg);</span></span>
<span class="line"></span></code></pre></div><p>Note that we have created a mutable client. Sending and receiving messages affects the client&#39;s internal state.</p><p>Of course, depending on your application, you might want to de-serialise your <code>MyConfiguration</code> structure from a different location. Perhaps, you might want to build the configuration in place using the command-line arguments, or perhaps, you&#39;re using the XDG specification to store the file persistently in a different location. For this purpose, it&#39;s useful to try and construct the <code>ClientConfiguration</code>.</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_core</span><span style="color:#CF222E;">::</span><span style="color:#953800;">prelude</span><span style="color:#CF222E;">::*</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">prelude</span><span style="color:#CF222E;">::*</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> kp </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">KeyPair</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    public_key</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">PublicKey</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">from_str</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#0A3069;">r#&quot;ed01207233bfc89dcbd68c19fde6ce6158225298ec1131b6a130d1aeb454c1ab5183c0&quot;#</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    )</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">unwrap</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    private_key</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">PrivateKey</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">        digest_function</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;ed25519&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_string</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">        payload</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">hex_literal</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">hex!</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#0A3069;">&quot;</span></span>
<span class="line"><span style="color:#0A3069;">            9AC47ABF 59B356E0</span></span>
<span class="line"><span style="color:#0A3069;">            BD7DCBBB B4DEC080</span></span>
<span class="line"><span style="color:#0A3069;">            E302156A 48CA907E</span></span>
<span class="line"><span style="color:#0A3069;">            47CB6AEA 1D32719E</span></span>
<span class="line"><span style="color:#0A3069;">            7233BFC8 9DCBD68C</span></span>
<span class="line"><span style="color:#0A3069;">            19FDE6CE 61582252</span></span>
<span class="line"><span style="color:#0A3069;">            98EC1131 B6A130D1</span></span>
<span class="line"><span style="color:#0A3069;">            AEB454C1 AB5183C0</span></span>
<span class="line"><span style="color:#0A3069;">            &quot;</span></span>
<span class="line"><span style="color:#24292F;">        )</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">into</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    },</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> (public_key, private_key) </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> kp</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">clone</span><span style="color:#24292F;">()</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">into</span><span style="color:#24292F;">();</span></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> account_id </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;alice&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    domain_name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> cfg </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">ClientConfiguration</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    public_key,</span></span>
<span class="line"><span style="color:#24292F;">    private_key,</span></span>
<span class="line"><span style="color:#24292F;">    account_id,</span></span>
<span class="line"><span style="color:#24292F;">    torii_api_url</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">uri</span><span style="color:#CF222E;">::</span><span style="color:#0550AE;">DEFAULT_API_URL</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">..</span><span style="color:#953800;">ClientConfiguration</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">default</span><span style="color:#24292F;">()</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>There are a few things that may prove confusing. If you look at the <code>config.json</code>, you&#39;ll see that the keys are given in <a href="https://github.com/multiformats/multihash" target="_blank" rel="noopener noreferrer">multi-hash format</a>. If you\u2019ve never worked with multi-hash before, it is natural to assume that the right-hand-side is not a hexadecimal representation of the key bytes (two symbols per byte), but rather the bytes encoded as ASCII (or UTF-8), and call <code>from_string</code> on the string literal in both the <code>public_key</code> and <code>private_key</code> instantiation.</p><p>It is also natural to assume that calling <code>PrivateKey::try_from_str</code> on the string literal would yield only the correct key. So if I get the number of bits in the key wrong, e.g. 32 bytes vs 64, that it would raise an error message.</p><p><strong>Both of these assumptions are wrong.</strong> Unfortunately, the error messages don\u2019t help in de-bugging this particular kind of failure.</p><p><strong>How to fix</strong> \u2014 trivial: just use <code>hex_literal</code>. This will also turn an ugly string of characters into a nice small table of obviously hexadecimal numbers.</p><p><strong>BEWARE</strong>: even the <code>try_from_str</code> implementation cannot verify if a given string is a valid <code>PrivateKey</code>, and warn you if it isn&#39;t. It will catch some obvious errors, like if the string contains an invalid symbol, but because we aim to support many key formats, it can\u2019t do much else. It cannot tell if the key is the <em>correct</em> private key <em>for the given account</em> either, unless you submit an instruction.</p><p>These sorts of subtle mistakes can be avoided, by e.g. deserialising directly from string literals, or generating a fresh key-pair in places where it makes sense.</p></div><h2 id="_3-registering-a-domain" tabindex="-1">3. Registering a Domain <a class="header-anchor" href="#_3-registering-a-domain" aria-hidden="true">#</a></h2><p>Registering a domain is a relatively easy operation. Most of the boilerplate code has to do with setting up the Iroha 2 client and deserialising its configuration. To register a domain, you need the domain name;</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> looking_glass </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">domain</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Domain</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;looking_glass&quot;</span><span style="color:#24292F;">);</span></span>
<span class="line"></span></code></pre></div><p>Which we convert into an instruction</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">isi</span><span style="color:#CF222E;">::</span><span style="color:#24292F;">{</span><span style="color:#953800;">RegisterBox</span><span style="color:#24292F;">, </span><span style="color:#953800;">IdentifiableBox</span><span style="color:#24292F;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> create_looking_glass </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">RegisterBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(</span><span style="color:#953800;">IdentifiableBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">from</span><span style="color:#24292F;">(looking_glass));</span></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> metadata </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">metadata</span><span style="color:#CF222E;">::</span><span style="color:#953800;">UnlimitedMetadata</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">default</span><span style="color:#24292F;">();</span></span>
<span class="line"></span></code></pre></div><p>Note that we use <code>RegisterBox</code> and <code>IdentifiableBox</code> . Despite what your instincts as a Rust developer might suggest, we&#39;re not actually using any kind of dynamic dispatch. There&#39;s no <code>dyn</code> anywhere, and <code>RegisterBox</code> isn&#39;t an alias for <code>Box&lt;dyn Register&gt;</code>.</p><p>A <code>RegisterBox</code> is a specialised <code>enum</code> that uses static dispatch to achieve what looks like dynamic dispatch, without any heap allocation. If you want to add more types to <code>RegisterBox</code> you must either open an issue on GitHub, or do that by yourself on a local fork of Iroha.</p><p>The instruction is then batched into a transaction</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> tx </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> iroha_client</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">build_transaction</span><span style="color:#24292F;">(</span><span style="color:#8250DF;">vec!</span><span style="color:#24292F;">[instruction], metadata)</span><span style="color:#CF222E;">?</span><span style="color:#24292F;">;</span></span>
<span class="line"></span></code></pre></div><p>Which is then submitted into the pipeline.</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">iroha_client</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">submit_transaction</span><span style="color:#24292F;">(tx)</span><span style="color:#CF222E;">?</span><span style="color:#24292F;">;</span></span>
<span class="line"></span></code></pre></div><p>Note the question mark here. This will return an <code>Err</code> variant if there&#39;s something immediately and obviously wrong with the transaction, such as, if it couldn&#39;t submit the transaction to the peer (e.g. there&#39;s no connection), or if the transaction got rejected with an error. The cost is that the <code>submit_transaction</code> function is synchronous.</p><p>We could have also done the following:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">iroha_client</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">submit</span><span style="color:#24292F;">(create_looking_glass);</span></span>
<span class="line"></span></code></pre></div><p>This is done without attaching either any metadata or building a transaction. The latter style will lead to subtle errors, so until you know a bit more about Iroha, it might be a good idea not to do it.</p><h2 id="_4-registering-an-account" tabindex="-1">4. Registering an Account <a class="header-anchor" href="#_4-registering-an-account" aria-hidden="true">#</a></h2><p>Registering an account is a bit more involved than registering a domain. With a domain, the only concern is the domain name, however, with an account, there are a few more things to worry about.</p><p>First of all, we need to create an <code>AccountId</code>. Note, that we can only register an account to an existing domain. The best UX design practices dictate that you should check if the requested domain exists <em>now</em>, and if it doesn\u2019t \u2014 suggest a fix to the user. After that, we can create a new account, that we name <em>white_rabbit.</em></p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> id </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">account</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Id</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;white_rabbit&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    domain_name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;looking_glass&quot;</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p>Second, you should provide the account with a public key. It is tempting to generate both it and the private key at this time, but it isn&#39;t the brightest idea. Remember, that <em>the white_rabbit</em> trusts <em>you, alice@wonderland,</em> to create an account for them in the domain <em>looking_glass, <strong>but doesn&#39;t want you to have access to that account after creation</strong>.</em> If you gave <em>white_rabbit</em> a key that you generated yourself, how would they know if you don&#39;t have a copy of their private key? Instead, the best way is to <strong>ask</strong> <em>white_rabbit</em> to generate a new key-pair, and give you the public half of it.</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> key</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">PublicKey</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">get_key_from_white_rabbit</span><span style="color:#24292F;">();</span></span>
<span class="line"></span></code></pre></div><p>Only then do we build an instruction from it:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> create_account </span><span style="color:#CF222E;">=</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">RegisterBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(</span><span style="color:#953800;">IdentifiableBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">from</span><span style="color:#24292F;">(</span><span style="color:#953800;">NewAccount</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">with_signatory</span><span style="color:#24292F;">(id, key)));</span></span>
<span class="line"></span></code></pre></div><p>Which is then <strong>wrapped in a transaction</strong> and <strong>submitted to the peer</strong> as <a href="#_3-registering-a-domain">in the previous section</a>.</p><h2 id="_5-registering-and-minting-assets" tabindex="-1">5. Registering and minting assets <a class="header-anchor" href="#_5-registering-and-minting-assets" aria-hidden="true">#</a></h2><p>Now we must talk a little about assets. Iroha has been built with few underlying assumptions about what the assets need to be. The assets can be fungible (every \xA31 is exactly the same as every other \xA31), or non-fungible (a \xA31 bill signed by the Queen of Hearts is not the same as a \xA31 bill signed by the King of Spades), mintable (you can make more of them) and non-mintable (you can only specify their initial quantity in the genesis block). Additionally, the assets have different underlying value types.</p><p>Specifically, we have <code>AssetValueType::Quantity</code> which is effectively an unsigned 32-bit integer, a <code>BigQuantity</code> which is an unsigned 128 bit integer, which is enough to trade all possible IPV6 addresses, and quite possibly individual grains of sand on the surface of the earth and <code>Fixed</code>, which is a positive (though signed) 64-bit fixed-precision number with nine significant digits after the decimal point. It doesn&#39;t quite use binary-coded decimal for performance reasons. All three types can be registered as either <strong>mintable</strong> or <strong>non-mintable</strong>.</p><p>Now, let&#39;s get back to coding. To register an asset, we first construct an <code>iroha_data_model::asset::DefinitionId</code> like so:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">asset</span><span style="color:#CF222E;">::</span><span style="color:#953800;">DefinitionId</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> id </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">DefinitionId</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;time&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    domain_name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;looking_glass&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p>Then construct an instruction</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> register_time </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">RegisterBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(</span><span style="color:#953800;">IdentifiableBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">AssetDefinition</span><span style="color:#24292F;">(</span><span style="color:#953800;">AssetDefinition</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">    id,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">AssetValueType</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Fixed</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#0550AE;">false</span><span style="color:#6E7781;"> // If only we could mint more time.</span></span>
<span class="line"><span style="color:#24292F;">)));</span></span>
<span class="line"></span></code></pre></div><p>For technical reasons, this would (<em>for now</em>) create a completely useless asset. In order to mint, one must already have an asset definition in the blockchain. A non-mintable asset definition, however cannot be minted by definition.</p><p>This means that no matter how hard the <em>white_rabbit</em> tries, the time that he has is the time that was given to him at genesis. And since we haven\u2019t defined any time in the domain <em>looking_glass at</em> genesis and defined time in a non-mintable fashion afterwards, the <em>white_rabbit</em> is doomed to always be late.</p><p>Roses, by contrast are already registered in the network during the genesis, and belong to <em>alice@wonderland, so</em> we can mint them without much trouble. Let&#39;s prepare some data:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> roses </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">DefinitionId</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;roses&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    domain_name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> alice </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">account</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Id</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;alice&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">    domain_name</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">to_owned</span><span style="color:#24292F;">(),</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p>And build an instruction:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">prelude</span><span style="color:#CF222E;">::*</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> mint_roses </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">MintBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">Value</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">U32</span><span style="color:#24292F;">(</span><span style="color:#0550AE;">42</span><span style="color:#24292F;">),</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">IdBox</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">AssetId</span><span style="color:#24292F;">(</span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">asset</span><span style="color:#CF222E;">::</span><span style="color:#953800;">Id</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">new</span><span style="color:#24292F;">(roses, alice)),</span></span>
<span class="line"><span style="color:#24292F;">);</span></span>
<span class="line"></span></code></pre></div><p>Which we then submit as usual. Make sure that the asset has the right type. Roses are a <code>Quantity</code>. You would think that it would also be possible to mint <code>rose</code>s if they were <code>BigQuantity</code> or <code>Fixed</code>, using <code>Value::U32</code>, but you&#39;d be wrong.</p><p>Contrary to what you might think, this restriction isn&#39;t just for pedantry. Implicit conversion errors are the bane of all programmers, if you got the <em>AssetValueType</em> incorrect, <em>how do you know that it was the only mistake in that transaction?</em></p><h2 id="_6-visualising-outputs" tabindex="-1">6. Visualising outputs <a class="header-anchor" href="#_6-visualising-outputs" aria-hidden="true">#</a></h2><p>Finally, we should talk about visualising data. The Rust API is currently the most complete in terms of available queries and instructions. After all, this is the language in which Iroha 2 was built.</p><p>We shall, however, leave most of the aforementioned advanced features down the rabbit hole, up to the reader&#39;s own devices to discover. This document can easily get out of sync with the state of the API features. By contrast, the online documentation is always up to date. Plus a short tutorial wouldn&#39;t be able to do all these features justice. Instead, we shall retain parity with other language tutorials and introduce you to pipeline filters.</p><p>There are two possible event filters: <code>PipelineEventFilter</code> and <code>DataEventFilter</code>, we shall focus on the former. This filter sieves events pertaining to the process of submitting a transaction, executing a transaction, and committing it to a block.</p><p>First, let&#39;s build a filter</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">use</span><span style="color:#24292F;"> </span><span style="color:#953800;">iroha_data_model</span><span style="color:#CF222E;">::</span><span style="color:#953800;">prelude</span><span style="color:#CF222E;">::*</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">let</span><span style="color:#24292F;"> filter </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">EventFilter</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">Pipeline</span><span style="color:#24292F;">(</span><span style="color:#953800;">PipelineEventFilter</span><span style="color:#CF222E;">::</span><span style="color:#8250DF;">identity</span><span style="color:#24292F;">());</span></span>
<span class="line"></span></code></pre></div><p>Then, we start listening for events in an infinite loop:</p><div class="language-rust"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">for</span><span style="color:#24292F;"> event </span><span style="color:#CF222E;">in</span><span style="color:#24292F;"> iroha_client</span><span style="color:#CF222E;">.</span><span style="color:#8250DF;">listen_for_events</span><span style="color:#24292F;">(filter)</span><span style="color:#CF222E;">?</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">match</span><span style="color:#24292F;"> event {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">Ok</span><span style="color:#24292F;">(event) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">println!</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;Success: {:#?}&quot;</span><span style="color:#24292F;">, event),</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">Err</span><span style="color:#24292F;">(err) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">println!</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;Sadness:( {:#?}&quot;</span><span style="color:#24292F;">,  err),</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p><strong>Needless to say that a synchronous infinite blocking loop is bad UX for anything but a command-line program</strong>, but for illustration purposes, this would create a nice printout, just like in <code>iroha_client_cli</code>.</p>`,70),t=[l];function p(r,i,c,y,d,h){return n(),a("div",null,t)}var g=s(o,[["render",p]]);export{F as __pageData,g as default};
